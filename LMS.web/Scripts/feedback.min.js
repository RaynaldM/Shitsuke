var feedback=function(){function n(){}return n.Ready=function(n,t,i,r,u){var f=this;this.token="lmstoken "+n;this.loaded?this.init(n,t,i,r):this.load(u).then(function(){f.init(n,t,i,r);f.report.attr("data-html2canvas-ignore",1);f.report.find("*").attr("data-html2canvas-ignore",1)})},n.init=function(n,t,i,r){this.report.find("form")[0].reset();$("#appcode").val(t);$("#userid").val(i);$("#token").val(n);$("#pageid").val(r);$("#browserinfo").val(JSON.stringify(getBrowserInfo()));this.setSave();this.setTakeScreenshot();this.setClose();this.bShow(this.report)},n.setSave=function(){var n=this,i=this.report.find("form"),t=this.report.find(".loading");i.unbind("submit").on("submit",function(r){return r.preventDefault(),n.bHide(n.report.find(".report")),n.bShow(t),$.ajax({type:"POST",url:window.lms+"/api/feedback/post",data:i.serialize(),contentType:"application/x-www-form-urlencoded; charset=UTF-8",crossDomain:!0,headers:{Authorization:n.token}}).done(function(){n.bHide(t);n.bShow(n.report.find(".reported"))}).fail(function(){n.bHide(t);n.bShow(n.report.find(".failed"))}),!1})},n.setTakeScreenshot=function(){this.report.find(".screenshot").unbind("click").on("click",function(n){var t=$(n.currentTarget);t.find("i").removeClass("fa-camera fa-check").addClass("fa-refresh fa-spin");html2canvas(document.body,{onrendered:function(n){$(".screen-uri").val(n.toDataURL("image/png"));t.find("i").removeClass("fa-refresh fa-spin").addClass("fa-check")}})})},n.setClose=function(){var n=this;this.report.find("#lms-close, .close,.bclose").unbind("click").on("click",function(){n.bHide(n.report);n.report.find("textarea").val("");n.report.find(".screen-uri").val("");n.bShow(n.report.find("form"));n.bHide(n.report.find(".failed"));n.bHide(n.report.find(".reported"));n.report.find("i.cam").removeClass("fa-refresh fa-spin").addClass("fa-camera")})},n.load=function(n){var t=this;return this.getScripts(["//cdnjs.cloudflare.com/ajax/libs/handlebars.js/4.0.5/handlebars.min.js",window.lms+"/bundles/embrsc_"+n.substring(0,2),"//cdnjs.cloudflare.com/ajax/libs/html2canvas/0.4.1/html2canvas.min.js"]).then(function(){return $.ajax({type:"GET",url:window.lms+"/html/feedback.min.html",crossDomain:!0}).then(function(n){n=n.replace("{root}",window.lms);var i=Handlebars.compile(n);n=i(Resources);$("#lmsFeedBack").append(n);t.loaded=!0;t.report=$("#lms-report")})})},n.bShow=function(n){n.removeClass("hidden").addClass("show").show()},n.bHide=function(n){n.removeClass("show").addClass("hidden").hide()},n.getScripts=function(n){for(var r=n.length,u=0,f=function(){u++},i=[],t=0;t<r;t++)i.push($.getScript(n[t],f));return $.when.apply(null,i)},n.loaded=!1,n}();
//# sourceMappingURL=feedback.min.js.map
